# CAVE: Concealed Artifacts for Volatile Evasion

<h1 align="center">
  <img src="https://github.com/CYFARE/CAVE/blob/main/assets/CAVE.png" alt="CAVE Logo">
</h1>

## <h2 align="center">
  <img src="https://img.shields.io/badge/-GPLv2.0-61DAFB?style=for-the-badge" alt="License: GPLv2.0">&nbsp;
</h2>

**CAVE**, or **C**oncealed **A**rtifacts for **V**olatile **E**vasion - A modular command-line tool designed to generate various Windows AV/EDR evasion artifacts.

## Releases & Features

### Release Cycle

This is a rolling release tool, which means that new features and techniques will be added continuously. Always make sure your local copy is up-to-date by pulling the latest changes.

### Features

*   **Modular Design**: Easily add new evasion techniques by creating new modules in the `core` directory.
*   **Variety of Techniques**: Includes implementations for common evasion strategies such as:
    *   APC Injection
    *   API Unhooking
    *   Direct Syscalls
    *   DLL Injection
    *   Process Hollowing
    *   VBA Macro Generation
    *   WMI Persistence Setup/Removal
*   **Payload Agnostic**: Works with any raw shellcode provided in a binary file (`-p`/`--payload`).
*   **Cross-Compilation**: Generates Windows executables and DLLs using the MinGW-w64 cross-compiler.
*   **Shellcode Obfuscation**: Includes basic shellcode obfuscation (e.g., XOR, Base64) before embedding in the generated artifact.
*   **Configurable Options**: Each technique exposes specific command-line options to customize its behavior (e.g., target process, output filenames, WMI parameters).
*   **Configurable Output**: Specify a custom output directory for generated files (`config.py`, defaults to `output/`).

## Setup & Usage

### Setup

1.  **Clone the repository**:
    ```bash
    git clone https://github.com/CYFARE/CAVE.git
    cd CAVE
    ```

2.  **Set up a Python virtual environment**:
    ```bash
    pyenv install 3.10.11
    pyenv local 3.10.11
    python3 -m venv venv
    ```

3.  **Activate the virtual environment**:
    *   On Linux:
        ```bash
        source venv/bin/activate
        ```

4.  **Install Python dependencies**:
    ```bash
    python -m pip install --upgrade pip
    python -m pip install -r requirements.txt
    ```

5.  **Install MinGW-w64 Cross-Compiler**: CAVE uses `x86_64-w64-mingw32-gcc` and `x86_64-w64-mingw32-g++` for compiling Windows artifacts. You can try running the setup script (for Debian/Ubuntu, Fedora, or Arch Linux):
    ```bash
    chmod +x setup.sh
    ./setup.sh
    ```
    If the script fails or you are on a different OS, you will need to install `mingw-w64` manually via your package manager or download it.

### Usage

Run the main script (`main.py`) from within your activated virtual environment.

#### List available techniques

```bash
python3 main.py list
```

#### Get help for a specific technique

```bash
python3 main.py <technique-name> --help
```
Replace `<technique-name>` with the name of the technique (e.g., `process-hollowing`, `dll-injection`).

#### Generate an artifact

Use the technique name as a subcommand, followed by its required and optional arguments.

*   **Example: Generate a Process Hollowing executable**
    ```bash
    python3 main.py process-hollowing --payload payloads/beacon.bin --output ph_artifact.exe --process C:\\Windows\\System32\\notepad.exe
    ```

*   **Example: Generate DLL Injection artifacts (DLL and Loader EXE)**
    ```bash
    python3 main.py dll-injection --payload payloads/beacon.bin --output-dll injected_payload.dll --output-exe dll_loader.exe --process-name notepad.exe
    ```

*   **Example: Generate a VBA Macro**
    ```bash
    python3 main.py vba-macro --payload payloads/beacon.bin --output office_macro.vba
    ```

*   **Example: Generate a WMI Persistence Setup script**
    ```bash
    python3 main.py wmi-persistence --action setup --payload payloads/beacon.bin --output wmi_setup.vbs --filter-name MyWMIFilter --consumer-name MyWMIConsumer --payload-script-name dropped_payload.vbs --payload-drop-dir C:\\Users\\Public\\Libraries
    ```

*   **Example: Generate a WMI Persistence Removal script**
    ```bash
    python3 main.py wmi-persistence --action remove --output wmi_remove.vbs --filter-name MyWMIFilter --consumer-name MyWMIConsumer --payload-script-name dropped_payload.vbs --payload-drop-dir C:\\Users\\Public\\Libraries
    ```

Place your raw shellcode file (e.g., generated by `msfvenom`) in the `payloads/` directory or specify its full path. See `payloads/README.md` for more details on payload generation.

## Support

If you encounter issues or have suggestions, please refer to the project's repository page for issue tracking. You can support the work by becoming a sponsor or through: https://cyfare.net/apps/Social/

## License

GPLv2.0
